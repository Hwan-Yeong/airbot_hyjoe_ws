bt_navigator:
        ros__parameters:
                use_sim_time: False
                global_frame: map
                robot_base_frame: base_link # 0317-base_footprint
                odom_topic: /odom
                enable_groot_monitoring: True
                groot_zmq_publisher_port: 1666
                groot_zmq_server_port: 1667
                default_server_timeout: 500
                wait_for_service_timeout: 3000
                  #transform_tolerance: 1.0
                default_nav_to_pose_bt_xml: $(find-pkg-share wm_nav_launch)/behavior_trees/explore_recovery.xml
                bt_loop_duration: 200
                plugin_lib_names:
                        - nav2_compute_path_to_pose_action_bt_node
                        - nav2_compute_path_through_poses_action_bt_node
                        - nav2_smooth_path_action_bt_node
                        - nav2_follow_path_action_bt_node
                        - nav2_spin_action_bt_node
                        - nav2_wait_action_bt_node
                        - nav2_assisted_teleop_action_bt_node
                        - nav2_back_up_action_bt_node
                        - nav2_drive_on_heading_bt_node
                        - nav2_clear_costmap_service_bt_node
                        - nav2_is_stuck_condition_bt_node
                        - nav2_goal_reached_condition_bt_node
                        - nav2_goal_updated_condition_bt_node
                        - nav2_globally_updated_goal_condition_bt_node
                        - nav2_is_path_valid_condition_bt_node
                        - nav2_initial_pose_received_condition_bt_node
                        - nav2_reinitialize_global_localization_service_bt_node
                        - nav2_rate_controller_bt_node
                        - nav2_distance_controller_bt_node
                        - nav2_speed_controller_bt_node
                        - nav2_truncate_path_action_bt_node
                        - nav2_truncate_path_local_action_bt_node
                        - nav2_goal_updater_node_bt_node
                        - nav2_recovery_node_bt_node
                        - nav2_pipeline_sequence_bt_node
                        - nav2_round_robin_node_bt_node
                        - nav2_transform_available_condition_bt_node
                        - nav2_time_expired_condition_bt_node
                        - nav2_path_expiring_timer_condition
                        - nav2_distance_traveled_condition_bt_node
                        - nav2_single_trigger_bt_node
                        - nav2_goal_updated_controller_bt_node
                        - nav2_is_battery_low_condition_bt_node
                        - nav2_navigate_through_poses_action_bt_node
                        - nav2_navigate_to_pose_action_bt_node
                        - nav2_remove_passed_goals_action_bt_node
                        - nav2_planner_selector_bt_node
                        - nav2_controller_selector_bt_node
                        - nav2_goal_checker_selector_bt_node
                        - nav2_controller_cancel_bt_node
                        - nav2_path_longer_on_approach_bt_node
                        - nav2_wait_cancel_bt_node
                        - nav2_spin_cancel_bt_node
                        - nav2_back_up_cancel_bt_node
                        - nav2_assisted_teleop_cancel_bt_node
                        - nav2_drive_on_heading_cancel_bt_node
                        - nav2_is_battery_charging_condition_bt_node

        bt_navigator_rclcpp_node:
                ros__parameters:
                      use_sim_time: False

controller_server:
        ros__parameters:
                use_sim_time: False
                controller_frequency: 30.0
                goal_checker_plugins: ["general_goal_checker"] # "precise_goal_checker"
                progress_checker_plugins: ["progress_checker"]

                general_goal_checker:
                  stateful: False
                  plugin: "nav2_controller::SimpleGoalChecker"
                  xy_goal_tolerance: 0.25
                  yaw_goal_tolerance: 3.14

                progress_checker:
                  plugin: "nav2_controller::PoseProgressChecker"
                  required_movement_radius: 0.2
                  movement_time_allowance: 2.0

                FollowPath:
                        plugin: "nav2_mppi_controller::MPPIController"
                        time_steps: 56
                        model_dt: 0.05
                        batch_size: 1000
                        vx_std: 0.2
                        vy_std: 0.2
                        wz_std: 0.4
                        vx_max: 0.3
                        vx_min: 0.0
                        vy_max: 0.5
                        wz_max: 1.9
                        ax_max: 0.3
                        ax_min: -0.3
                        ay_max: 0.3
                        az_max: 3.5
                        iteration_count: 1
                        prune_distance: 1.0
                        transform_tolerance: 1.0
                        temperature: 0.3
                        gamma: 0.015
                        motion_model: "DiffDrive"
                        visualize: false
                        reset_period: 1.0 # (only in Humble)
                        regenerate_noises: false
                        TrajectoryVisualizer:
                              trajectory_step: 5
                              time_step: 3
                        AckermannConstraints:
                              min_turning_r: 0.0
                        critics: ["ConstraintCritic", "CostCritic", "GoalCritic", "GoalAngleCritic", "PathAlignCritic", "PathFollowCritic", "PathAngleCritic", "PreferForwardCritic"]
                        ConstraintCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 4.0
                        GoalCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 5.0
                              threshold_to_consider: 1.4
                        GoalAngleCritic:
                              enabled: false
                              cost_power: 1
                              cost_weight: 3.0
                              threshold_to_consider: 0.5
                        PreferForwardCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 25.0
                              threshold_to_consider: 0.5
                        CostCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 3.81
                              critical_cost: 300.0
                              consider_footprint: true
                              collision_cost: 1000000.0
                              near_goal_distance: 0.3
                              trajectory_point_step: 2
                        PathAlignCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 14.0
                              max_path_occupancy_ratio: 0.05
                              trajectory_point_step: 4
                              threshold_to_consider: 0.5
                              offset_from_furthest: 20
                              use_path_orientations: false
                        PathFollowCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 5.0
                              offset_from_furthest: 5
                              threshold_to_consider: 1.4
                        PathAngleCritic:
                              enabled: true
                              cost_power: 1
                              cost_weight: 2.0
                              offset_from_furthest: 4
                              threshold_to_consider: 0.5
                              max_angle_to_furthest: 1.0
                              mode: 0
                        ObstaclesCritic:
                              enabled: true
                              cost_power: 1
                              repulsion_weight: 1.5
                              critical_weight: 20.0
                              consider_footprint: false
                              collision_cost: 10000.0
                              collision_margin_distance: 0.1
                              near_goal_distance: 0.5
                              inflation_radius: 0.55 # (only in Humble)
                              cost_scaling_factor: 10.0 # (only in Humble) 

controller_server_rclcpp_node:
        ros__parameters:
                use_sim_time: False

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 20.0
      publish_frequency: 10.0
      global_frame: map
      robot_base_frame: base_link
      use_sim_time: False
      rolling_window: true
      static_map: false
      width: 3
      height: 3
      resolution: 0.05
      # 2025-01-07 [2 lidar + Camera + multi tof] 사용 버전
      # robot_radius: 0.20
      # 2025-01-08 [2 lidar + Camera] 사용 버전
      robot_radius: 0.22
      plugins: ["static_layer","obstacle_layer", "inflation_layer"]
      obstacle_layer:
        combination_method: 1
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        min_obstacle_height: -0.1
        footprint_clearing_enabled: true
        observation_sources: scan perception
        scan:
          sensor_frame: "base_scan"
          topic: /scan
          inf_is_valid: true
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 1.0
          raytrace_min_range: 0.17
          obstacle_max_range: 1.0
          obstacle_min_range: 0.17
          observation_persistence: 3.0
  
        perception:
          sensor_frame: "map"
          topic: /perception/output
          min_obstacle_height: -3.0
          max_obstacle_height: 10.0
          clearing: True
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 1000.0
          raytrace_min_range: 0.0
          obstacle_max_range: 1000.0
          obstacle_min_range: 0.0
          
        camera_data:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/camera_object
          min_obstacle_height: -0.5
          max_obstacle_height: 0.9
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 1.0
          raytrace_min_range: 0.0
          obstacle_max_range: 1.0
          obstacle_min_range: 0.0
          
        l_3_tof:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/tof/multi/left/row_3
          min_obstacle_height: 0.015
          max_obstacle_height: 0.07
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 1.0
          raytrace_min_range: 0.4
          obstacle_max_range: 1.0
          obstacle_min_range: 0.4
                 
        l_4_tof:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/tof/multi/left/row_4
          min_obstacle_height: 0.0
          max_obstacle_height: 0.025
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 0.6
          raytrace_min_range: 0.25
          obstacle_max_range: 0.6
          obstacle_min_range: 0.25
                 
        r_3_tof:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/tof/multi/right/row_3
          min_obstacle_height: 0.015
          max_obstacle_height: 0.07
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 1.0
          raytrace_min_range: 0.4
          obstacle_max_range: 1.0
          obstacle_min_range: 0.4
                 
        r_4_tof:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/tof/multi/right/row_4
          min_obstacle_height: 0.0
          max_obstacle_height: 0.025
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 0.6
          raytrace_min_range: 0.25
          obstacle_max_range: 0.6
          obstacle_min_range: 0.25
                
        multi_tof:
          sensor_frame: "base_link"
          topic: /sensor_to_pointcloud/tof/multi
          min_obstacle_height: 0.15
          max_obstacle_height: 0.75
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 1.0
          raytrace_min_range: 0.0
          obstacle_max_range: 1.0
          obstacle_min_range: 0.0
        
        mono_tof:
          topic: /sensor_to_pointcloud/tof/mono
          sensor_frame: "base_link"
          min_obstacle_height: 0.2
          max_obstacle_height: 3.75
          clearing: False
          marking: True
          data_type: "PointCloud2"
          raytrace_max_range: 0.65
          raytrace_min_range: 0.25
          obstacle_max_range: 0.65
          obstacle_min_range: 0.25
          observation_persistence: 30.0

      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 25.0
        # 2025-01-07 [2 lidar + Camera + multi tof] 사용 버전
        # inflation_radius: 0.21
        # 2025-01-08 [2 lidar + Camera] 사용 버전
        inflation_radius: 1.24
      always_send_full_costmap: True

global_costmap:
        global_costmap:
                ros__parameters:
                        footprint_padding: 0.01
                        robot_radius: 0.22
                        update_frequency: 5.0
                        publish_frequency: 3.0
                        global_frame: map
                        robot_base_frame: base_link
                        use_sim_time: False
                        resolution: 0.05
                        plugins: ["static_layer","obstacle_layer","inflation_layer"]
                        obstacle_layer:
                                combination_method: 1
                                plugin: "nav2_costmap_2d::ObstacleLayer"
                                enabled: True
                                footprint_clearing_enabled: true
                                observation_sources: scan perception
                                scan:
                                  sensor_frame: "base_scan"
                                  topic: /scan
                                  max_obstacle_height: 2.0
                                  clearing: True
                                  marking: True
                                  data_type: "LaserScan"
                                  raytrace_max_range: 1.0
                                  raytrace_min_range: 0.17
                                  obstacle_max_range: 1.0
                                  obstacle_min_range: 0.17
                                  observation_persistence: 3.0

                                perception:
                                  sensor_frame: "map"
                                  topic: /perception/output
                                  min_obstacle_height: -3.0
                                  max_obstacle_height: 10.0
                                  clearing: True
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 1000.0
                                  raytrace_min_range: 0.0
                                  obstacle_max_range: 1000.0
                                  obstacle_min_range: 0.0

                                camera_data:
                                  topic: /sensor_to_pointcloud/camera_object
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.85
                                  min_obstacle_height: -0.5
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 1.0
                                  raytrace_min_range: 0.0
                                  obstacle_max_range: 1.0
                                  obstacle_min_range: 0.0
                                  observation_persistence: 30.0

                                l_3_tof:
                                  topic: /sensor_to_pointcloud/tof/multi/left/row_3
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.07
                                  min_obstacle_height: 0.015
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 1.0
                                  raytrace_min_range: 0.4
                                  obstacle_max_range: 1.0
                                  obstacle_min_range: 0.4
                                  observation_persistence: 30.0

                                l_4_tof:
                                  topic: /sensor_to_pointcloud/tof/multi/left/row_4
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.025
                                  min_obstacle_height: 0.0
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 0.6
                                  raytrace_min_range: 0.25
                                  obstacle_max_range: 0.6
                                  obstacle_min_range: 0.25
                                  observation_persistence: 30.0

                                r_3_tof:
                                  topic: /sensor_to_pointcloud/tof/multi/right/row_3
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.07
                                  min_obstacle_height: 0.015
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 1.0
                                  raytrace_min_range: 0.4
                                  obstacle_max_range: 1.0
                                  obstacle_min_range: 0.4
                                  observation_persistence: 30.0

                                r_4_tof:
                                  topic: /sensor_to_pointcloud/tof/multi/right/row_4
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.025
                                  min_obstacle_height: 0.0
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 0.6
                                  raytrace_min_range: 0.25
                                  obstacle_max_range: 0.6
                                  obstacle_min_range: 0.25
                                  observation_persistence: 30.0

                                multi_tof:
                                  topic: /sensor_to_pointcloud/tof/multi
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 0.75
                                  min_obstacle_height: 0.15
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 1.0
                                  raytrace_min_range: 0.0
                                  obstacle_max_range: 1.0
                                  obstacle_min_range: 0.0
                                  observation_persistence: 30.0

                                mono_tof:
                                  topic: /sensor_to_pointcloud/tof/mono
                                  sensor_frame: "base_link"
                                  max_obstacle_height: 4.0
                                  min_obstacle_height: 0.2
                                  clearing: False
                                  marking: True
                                  data_type: "PointCloud2"
                                  raytrace_max_range: 0.65
                                  raytrace_min_range: 0.25
                                  obstacle_max_range: 0.65
                                  obstacle_min_range: 0.25
                                  observation_persistence: 30.0
                        inflation_layer:
                                plugin: "nav2_costmap_2d::InflationLayer"
                                enabled: true
                                footprint_clearing_enabled: true
                                inflation_radius: 1.5
                                cost_scaling_factor: 25.0
                                inflate_unknown: false
                                inflate_around_unknown: False
                        static_layer:
                                plugin: "nav2_costmap_2d::StaticLayer"
                                map_subscribe_transient_local: True
                                enabled: true
                                subscribe_to_updates: true
                                transform_tolerance: 1.0
                        always_send_full_costmap: True

map_saver:
        ros__parameters:
                use_sim_time: False
                  #use_sim_time: True
                save_map_timeout: 5000
                free_thresh_default: 0.25
                occupied_thresh_default: 0.65

planner_server:
        ros__parameters:
                expected_planner_frequency: 1.0
                use_sim_time: False
                planner_plugins: ["GridBased"]
                GridBased:
                        plugin: "nav2_smac_planner/SmacPlanner2D"
                        tolerance: 1.125
                        downsample_costmap: false
                        downsampling_factor: 1
                        allow_unknown: true # true -> false
                        max_iterations: 1000000
                        max_on_approach_iterations: 1000
                        max_planning_time: 2.0
                        cost_travel_multiplier: 2.0
                        use_final_approach_orientation: true
                        smoother:
                          max_iterations: 1000
                          w_smooth: 0.3
                          w_data: 0.2
                          tolerance: 0.00001
        planner_server_rclcpp_node:
                ros__parameters:
                  use_sim_time: False

recoveries_server:
        ros__parameters:
                costmap_topic: local_costmap/costmap_raw
                footprint_topic: local_costmap/published_footprint
                cycle_frequency: 1.0
                  #recovery_plugins: ["spin", "back_up", "wait"]
                recovery_plugins: ["spin"]
                spin:
                        plugin: "nav2_recoveries/Spin"
                back_up:
                        plugin: "nav2_recoveries/Backup"
                global_frame: map
                robot_base_frame: base_link
                transform_timeout: 10.0
                use_sim_time: False
                simulate_ahead_time: 0.0
                max_rotational_vel: 0.0
                min_rotational_vel: 0.0
                rotational_acc_lim: 0.0    

robot_state_publisher:
        ros__parameters:
                use_sim_time: False


velocity_smoother:
        ros__parameters:
                use_sim_time: False
                smoothing_frequency: 20.0
                scale_velocities: False
                feedback: "OPEN_LOOP"
                  #feedback: "CLOSED_LOOP"
                max_velocity: [0.5, 0.0, 3.0]
                min_velocity: [-0.5, 0.0, -3.0]
                max_accel: [0.4, 0.0, 1.0]
                max_decel: [-0.4, 0.0, -2.0]
                odom_topic: "odom"
                odom_duration: 0.1
                deadband_velocity: [0.0, 0.0, 0.0]
                velocity_timeout: 1.0
